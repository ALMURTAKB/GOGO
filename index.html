<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>نموذج الطلب</title>
  <script type="module">
    // استيراد Firebase
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    // إعدادات Firebase الخاصة بك
        const firebaseConfig = {
      apiKey: "AIzaSyCxZKjnVEVjVBbgwAOUUbEg9D4KbEJqUG4",
      authDomain: "gogo-580c9.firebaseapp.com",
      projectId: "gogo-580c9",
      storageBucket: "gogo-580c9.firebasestorage.app",
      messagingSenderId: "1017270070832",
      appId: "1:1017270070832:web:802137b9719a1c525747f5",
      measurementId: "G-YRNMSSYD1W"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    window.addEventListener("DOMContentLoaded", () => {
      const form = document.getElementById('orderForm');

      form.addEventListener('submit', async function (event) {
        event.preventDefault();

        const productName = document.getElementById('productNameTitle').textContent.trim();
        const productImage = document.getElementById('mainImage').src;

        const originalPriceText = document.querySelector('.price').textContent;
        const originalPrice = parseInt(originalPriceText.replace(/[^\d]/g, ''));

        const discountPriceText = document.querySelector('.discount-price').textContent;
        const discountPrice = parseInt(discountPriceText.replace(/[^\d]/g, ''));

        const data = {
          name: form.name.value.trim(),
          governorate: form.governorate.value,
          address1: form.address1.value.trim(),
          address2: form.address2.value.trim(),
          landmark: form.landmark.value.trim(),
          phone1: form.phone1.value.trim(),
          phone2: form.phone2.value.trim(),
          productName: productName,
          productImage: productImage,
          originalPrice: originalPrice,
          discountPrice: discountPrice,
          createdAt: new Date()
        };

        try {
          await addDoc(collection(db, "orders"), data);
          document.getElementById('confirmationMessage').style.display = 'block';
          form.reset();
          window.scrollTo({ top: 0, behavior: 'smooth' });
        } catch (error) {
          alert("❌ حدث خطأ أثناء إرسال الطلب، حاول مرة أخرى.");
          console.error("Firestore Error:", error);
        }
      });
    });
  </script>
</head>
<body>

  <!-- معلومات المنتج -->
  <div class="product-info">
    <img id="mainImage" src="https://example.com/product.jpg" alt="صورة المنتج" width="200" />
    <h2 id="productNameTitle">اسم المنتج</h2>
    <div class="price">السعر الأصلي: 25000 دينار</div>
    <div class="discount-price">السعر بعد الخصم: 19000 دينار</div>
  </div>

  <!-- نموذج الطلب -->
  <form id="orderForm">
    <h3>معلومات الطلب</h3>
    <label>الاسم الكامل: <input type="text" name="name" required></label><br>
    <label>المحافظة: <input type="text" name="governorate" required></label><br>
    <label>العنوان الرئيسي: <input type="text" name="address1" required></label><br>
    <label>العنوان الفرعي: <input type="text" name="address2"></label><br>
    <label>اقرب نقطة دالة: <input type="text" name="landmark"></label><br>
    <label>رقم الهاتف 1: <input type="text" name="phone1" required></label><br>
    <label>رقم الهاتف 2 (اختياري): <input type="text" name="phone2"></label><br>
    <button type="submit">إرسال الطلب</button>
  </form>

  <!-- رسالة تأكيد -->
  <div id="confirmationMessage" style="display:none; color: green; font-weight: bold;">
    ✅ تم إرسال الطلب بنجاح!
  </div>

</body>
</html>
